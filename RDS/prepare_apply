import requests
import sys
from pprint import pprint

#requests.packages.urllib3.disable_warnings()

appliance_name = "dmc3.ginniemae.cloud"
bearer_token = "70baa440-2e99-4652-9249-9977b5fbf93b"
app = "1509"

def execute_rest(method, url, bearer_token, data):
    headers = {
        'Authorization': 'BEARER ' + bearer_token + '',
        'Content-Type': 'application/json'
    }
    
    response = requests.request(method, url, headers=headers, json=data)
    json = response.json()
    pprint(data)
    #pprint(json)
    return json
 

def get_vars(appliance_name, bearer_token, app):
    url = "https://"+appliance_name+"/api/apps/"+app+"/prepare-apply"
    data = ({
      "templateParameter": {
        "apply_immediately": False
      }
    })
    response = execute_rest("POST", url, bearer_token, data)
    #json = response
    #pprint(response)
    #pprint (response['data']['templateParameter'])
    (response['data']['templateParameter']['apply_immediately']) = 'true'
    #pprint (response['data']['templateParameter'])
    parameters = (response['data']['templateParameter'])
    return parameters

def apply_state(appliance_name, bearer_token, app, parameters):
    url = "https://"+appliance_name+"/api/apps/"+app+"/apply"
    data = ({
      "templateParameter": parameters
    })
    response = execute_rest("POST", url, bearer_token, data)
    #pprint(data)
    #json = response
    #pprint(response)
    #pprint (response['data']['templateParameter'])
    #(response['data']['templateParameter']['apply_immediately']) = 'true'
    #pprint (response['data']['templateParameter'])
    #parameters = (response['data']['templateParameter'])
    #return parameters

parameters = get_vars(appliance_name, bearer_token, app)
apply_state(appliance_name, bearer_token, app, parameters)

#data = ({
#      "templateParameter": parameters
#    })

#pprint(parameters)



#pprint (parameters)
